import{u as F,S as f,b as G,A as E,a as R,c as H,R as j,d as y,e as w,r as _,j as s,D as P,B as C,C as g,G as c,f as L,T as U,I as M,g as V,h,i as k,k as N}from"./main-f1f37423.js";import{P as W}from"./index-c84ab8d7.js";import{R as I,a as z}from"./index-2e1ef9e3.js";import{G as K}from"./index-07a62416.js";import{S as $,T as q}from"./SuneditorCustom-30be09ef.js";import{u as Q,a as J}from"./index-c6cf61ca.js";import{S as X}from"./Stack-28e64cc3.js";import"./KeyboardArrowRight-f0be6629.js";import"./Pagination-ceee7b8c.js";const Y=()=>{const{setToastInformation:r}=F(),[i]=Q(),[m]=J();return{createOrUpdateBook:async n=>{const d={name:n.name,author:n.author,genresList:n.genre.map(l=>l.slug).join(","),description:n.description,status:n.status.value,bookCover:n.bookImg,slug:n.slug};try{n.id?(await m({...d,id:n.id}),r({status:f.SUCCESS,message:f.SUCCESS})):(await i(d),r({status:f.SUCCESS,message:f.SUCCESS}))}catch(l){console.log(l)}}}},Z=G.injectEndpoints({endpoints:r=>({uploadFile:r.mutation({query:i=>({url:E.UPLOAD_API,method:"POST",body:i})})})}),{useUploadFileMutation:D}=Z,ee=()=>{const[r,i]=D();return{uploadFile:e=>{const n=new FormData;return Array.from(e).forEach((d,l)=>{n.append(`files[${l}]`,d)}),r(n).unwrap()},result:i}},se=r=>{const{open:i,handleClose:m,dataDetail:e}=r,{createOrUpdateBook:n}=Y(),d=R(),{list:l}=H({}),{uploadFile:S}=ee(),[p,T]=j.useState(null),x={name:e==null?void 0:e.name,bookCover:(e==null?void 0:e.bookCover)||"",author:e==null?void 0:e.author,genre:e==null?void 0:e.genresList,status:y.find(o=>o.value===(e==null?void 0:e.status)),description:e==null?void 0:e.description,slug:e==null?void 0:e.slug},{control:a,setValue:v,handleSubmit:O}=w({defaultValues:x,reValidateMode:"onChange",mode:"onChange"}),b=_.useRef(null),A=()=>{b.current&&b.current.click()},B=async o=>{let t=e==null?void 0:e.bookCover;p&&(t=(await S(o==null?void 0:o.bookCover))[0].fileUrl);const u={...o,bookImg:t,id:e==null?void 0:e.id};n(u),m()};return s.jsxs(P,{open:i,maxWidth:"lg",handleClose:m,actions:[s.jsx(C,{sx:{background:g.LIGHT_GREEN,color:g.WHITE,"&:hover":{background:g.LIGHT_GREEN}},onClick:O(B),children:"Save"})],dialogTitleProps:{title:e!=null&&e.id?"Chỉnh sửa truyện":"Thêm mới truyện",sx:{fontSize:"18px"}},children:[s.jsx("input",{hidden:!0,type:"file",ref:b,accept:"image/*",onChange:o=>{v("bookCover",o.target.files),T(URL.createObjectURL(o.target.files[0]))}}),s.jsxs(c,{container:!0,spacing:2,mt:1,children:[s.jsxs(c,{item:!0,xs:12,children:[s.jsxs(L,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[s.jsx(U,{sx:{fontSize:"14px",fontWeight:"bold",color:"#544949",marginLeft:"8px",whiteSpace:"nowrap"},children:"Ảnh bìa"}),s.jsx(C,{startIcon:s.jsx(M.UploadIcon,{}),onClick:A,sx:{color:g.WHITE,background:g.LIGHT_GREEN,"&:hover":{background:g.LIGHT_GREEN}},children:"Upload"})]}),s.jsx(L,{sx:{margin:"auto",display:"flex",justifyContent:"center",padding:"0px"},children:(p||(e==null?void 0:e.bookCover))&&s.jsx(V,{src:p||(e==null?void 0:e.bookCover),alt:"Hinh anh",width:"50%",height:"auto",loading:"lazy"})})]}),s.jsx(c,{item:!0,xs:6,children:s.jsx(h,{name:"name",control:a,render:({field:{onChange:o,value:t}})=>s.jsx(k,{onChange:o,value:t,title:"Tên truyện"})})}),s.jsx(c,{item:!0,xs:6,children:s.jsx(h,{name:"author",control:a,render:({field:{onChange:o,value:t}})=>s.jsx(k,{onChange:o,value:t,title:"Tác giả"})})}),s.jsx(c,{item:!0,xs:6,children:s.jsx(h,{name:"genre",control:a,render:({field:{onChange:o,value:t}})=>s.jsx(I,{title:"Thể loại",onChange:o,value:t,options:[{name:"Tất cả",slug:""},...l||[]],getOptionLabel:u=>u==null?void 0:u.name,getOptionValue:u=>u==null?void 0:u.slug,isMulti:!0})})}),s.jsx(c,{item:!0,xs:6,children:s.jsx(h,{name:"status",control:a,render:({field:{onChange:o,value:t}})=>s.jsx(I,{onChange:o,value:t,title:"Trạng thái",options:y})})}),s.jsx(c,{item:!0,xs:12,children:s.jsx(h,{name:"slug",control:a,render:({field:{onChange:o,value:t}})=>s.jsx(k,{onChange:o,value:t,title:"Tác giả"})})}),s.jsxs(c,{item:!0,xs:12,children:[s.jsx(U,{sx:{fontSize:"14px",fontWeight:"bold",color:"#544949",marginLeft:"8px",whiteSpace:"nowrap"},children:"Mô tả"}),s.jsx(h,{name:"description",control:a,render:({field:{onChange:o,value:t}})=>s.jsx($,{onChange:o,setContents:t,height:"300px",disableSunEditor:!1,hideToolbarSunEditor:!1})})]}),(e==null?void 0:e.id)&&s.jsx(c,{item:!0,xs:12,children:s.jsx(C,{sx:{background:"none",border:"1px solid #000!important",color:g.BLACK},onClick:()=>d(`/book-management/${e==null?void 0:e.slug}`),children:"Chi tiết chương truyện"})})]})]})},me=()=>{const[r,i]=j.useState(!1),[m,e]=j.useState(),{logout:n}=N(),d=[{Header:"Tên truyện",accessor:"name"},{Header:"Thể Loại",accessor:"genresList",Cell:({row:x})=>{var a;return s.jsx(K,{listGenre:(a=x==null?void 0:x.values)==null?void 0:a.genresList})}},{Header:"Tác giả",accessor:"author"},{Header:"Trạng thái",accessor:"status"},{Header:"Tổng chương",accessor:"totalChapters"},{Header:"",accessor:"Action"}],l=()=>{i(!1),e(void 0)},S=()=>{i(!0),e(void 0)},p=x=>{i(!0),e(x)},T=()=>{console.log("1")};return s.jsx(j.Fragment,{children:s.jsxs(W,{children:[s.jsx(c,{container:!0,spacing:2,children:s.jsxs(c,{item:!0,xs:12,mt:5,mb:5,children:[s.jsxs(X,{direction:"row",sx:{alignItems:"center",justifyContent:"space-between"},children:[s.jsx(q,{title:"Quản lý truyện"}),s.jsx(C,{color:"red",onClick:n,children:"Đăng xuất"})]}),s.jsx(z,{columns:d,data:[],onActionEdit:p,onActionDelete:T,onActionCreate:S,deleteUrl:E.DELETE_BOOK,showPagination:!0,endpoint:E.GET_ALL_BOOK})]})}),r&&s.jsx(se,{open:r,handleClose:l,dataDetail:m})]})})};export{me as default};
